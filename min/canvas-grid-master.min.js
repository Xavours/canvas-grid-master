function Wall(id,idParent,array,params){var self=this;this.id=id,this.idParent=idParent,this.source=array,this.width=window.innerWidth,this.height=window.innerHeight,this.settings={tileWidth:300,tileHeight:400,content:"rectangle",fadeAnimation:"easeOutCubic",scaleOn:!0,scale:1,minScale:.25,maxScale:1.75,scaleSensitivity:1,spreadMode:"random",startX:0,starY:0},params&&validOptions(params)?$.extend(this.settings,params):console.error("Some options are not valid"),this.updateNumberTile=function(){this.numberRow=Math.ceil(this.width/this.factorWidth)+1,this.numberCol=Math.ceil(this.height/this.factorHeight)+1},this.FPS=60,this.updateFPS=function(){this.FPS=fps.getFPS()},this.scale=this.settings.scale,this.updateScale=function(){this.factorWidth=this.settings.tileWidth*this.scale,this.factorHeight=this.settings.tileHeight*this.scale,this.current.virtualWidth=this.width/this.scale,this.current.virtualHeight=this.height/this.scale},this.updateSizeViewport=function(){this.width=canvas.width=window.innerWidth,this.height=canvas.height=window.innerHeight},this.current={positionX:0,positionY:0,viewportX:0,viewportY:0,time:0,identifyTile:function(x,y){var newX,newY,finalX,finalY;return newX=Math.floor(x/self.factorWidth),newY=Math.floor(y/self.factorHeight),finalX=0>newX||newX>=250?isEven(Math.floor(Math.abs(newX)/250))?250-Math.abs(newX):Math.abs(newX)-250:newX,finalY=0>newY||newY>=250?isEven(Math.floor(Math.abs(newY)/250))?250-Math.abs(newY):Math.abs(newY)-250:newY,this.source[(this.current.tileX+newX)%250][(this.current.tileY+newY)%250]},getTile:function(x,y){var newX,newY;newX=Math.floor(x/self.factorWidth),newY=Math.floor(y/self.factorHeight),x>=0?this.offsetX=self.factorWidth-x%self.factorWidth:this.offsetX=Math.abs(x)%self.factorWidth,y>=0?this.offsetY=self.factorHeight-y%self.factorHeight:this.offsetY=Math.abs(y)%self.factorHeight,0>newX||newX>=250?isEven(Math.floor(Math.abs(newX)/250))?this.tileX=250-Math.abs(newX):this.tileX=Math.abs(newX)-250:this.tileX=newX,0>newY||newY>=250?isEven(Math.floor(Math.abs(newY)/250))?this.tileY=250-Math.abs(newY):this.tileY=Math.abs(newY)-250:this.tileY=newY}},this.create=function(){$("#"+idParent).html('<canvas id="'+self.id+'" width="'+self.width+'" height="'+self.height+'">'),canvas=document.getElementById(self.id),ctx=canvas.getContext("2d")},this.destroy=function(){$("#"+idParent).html("")};var isPaused=!1;this.pause=function(){isPaused=!0},this.play=function(){isPaused=!1},this.getTile=function(x,y){if(x<this.current.offsetX)var newX=0;else var newX=Math.floor((x-this.current.offsetX)/this.factorWidth+1);if(y<this.current.offsetY)var newY=0;else var newY=Math.floor((y-this.current.offsetY)/this.factorHeight+1);return this.source[(this.current.tileX+newX)%250][(this.current.tileY+newY)%250]},this.onClick=function(tile){console.log("click"),OpenInNewTab(tile.imgSrc),openFocus(tile.index)},this.onMouseover=function(tile){"undefined"==typeof lastTileHovered.color?(self.current.tileHoveredAlpha=tile.color.alpha,tile.color.alpha=.5,tile.alphaEnd=.5,tile.time=200,tile.hovered=!0,lastTileHovered=tile):tile.hovered!==lastTileHovered.hovered&&(self.current.tileHoveredAlpha=tile.color.alpha,lastTileHovered.color.alpha=self.current.tileHoveredAlpha,lastTileHovered.alphaEnd=self.current.tileHoveredAlpha,lastTileHovered.time=200,tile.color.alpha=.5,tile.alphaEnd=.5,tile.time=200,lastTileHovered.hovered=!1,tile.hovered=!0,lastTileHovered=tile)},this.getTile=function(x,y){if(x<this.current.offsetX)var newX=0;else var newX=Math.floor((x-this.current.offsetX)/this.factorWidth+1);if(y<this.current.offsetY)var newY=0;else var newY=Math.floor((y-this.current.offsetY)/this.factorHeight+1);return this.source[(this.current.tileX+newX)%250][(this.current.tileY+newY)%250]},this.render=function(){this.updateScale(),this.updateNumberTile(),this.current.getTile(this.current.positionX,this.current.positionY),ctx.clearRect(0,0,self.width,self.height),isPaused||("image"==this.settings.content&&this.drawImages(),"rectangle"==this.settings.content&&this.drawRectangles())},this.drawRectangles=function(){for(var i=0;i<self.numberRow;i++)for(var j=0;j<self.numberCol;j++){var x=(this.current.tileX+i)%250,y=(this.current.tileY+j)%250,currentPoster=this.source[x][y];currentPoster.fade(),ctx.fillStyle=currentPoster.rgba,1>i?1>j?(ctx.fillRect(i*this.current.offsetX,j*this.current.offsetY,this.current.offsetX,this.current.offsetY),text(x,y,20,20)):(ctx.fillRect(i*this.current.offsetX,this.current.offsetY+(j-1)*this.factorHeight,this.current.offsetX,this.factorHeight),text(x,y,i*this.current.offsetX+20,this.current.offsetY+(j-1)*this.factorHeight+20)):1>j?(ctx.fillRect(this.current.offsetX+(i-1)*this.factorWidth,j*this.current.offsetY,this.factorWidth,this.current.offsetY),text(x,y,this.current.offsetX+(i-1)*this.factorWidth+20,j*this.current.offsetY+20)):(ctx.fillRect(this.current.offsetX+(i-1)*this.factorWidth,this.current.offsetY+(j-1)*this.factorHeight,this.factorWidth,this.factorHeight),text(x,y,this.current.offsetX+(i-1)*this.factorWidth+20,this.current.offsetY+(j-1)*this.factorHeight+20))}},this.drawImages=function(){for(var i=0;i<self.numberRow;i++)for(var j=0;j<self.numberCol;j++){var x=(this.current.tileX+i)%250,y=(this.current.tileY+j)%250,currentPoster=this.source[x][y],img=new Image;img.src=currentPoster.imgSrc,currentPoster.fade(),ctx.globalAlpha=currentPoster.color.alpha,1>i?1>j?ctx.drawImage(img,this.settings.tileWidth-this.current.offsetX/this.scale,this.settings.tileHeight-this.current.offsetY/this.scale,this.current.offsetX/this.scale,this.current.offsetY/this.scale,i*this.current.offsetX,j*this.current.offsetY,this.current.offsetX,this.current.offsetY):ctx.drawImage(img,this.settings.tileWidth-this.current.offsetX/this.scale,0,this.current.offsetX/this.scale,this.settings.tileHeight,i*this.current.offsetX,this.current.offsetY+(j-1)*this.factorHeight,this.current.offsetX,this.factorHeight):1>j?ctx.drawImage(img,0,this.settings.tileHeight-this.current.offsetY/this.scale,this.settings.tileWidth,this.current.offsetY/this.scale,this.current.offsetX+(i-1)*this.factorWidth,j*this.current.offsetY,this.factorWidth,this.current.offsetY):ctx.drawImage(img,0,0,this.settings.tileWidth,this.settings.tileHeight,this.current.offsetX+(i-1)*this.factorWidth,this.current.offsetY+(j-1)*this.factorHeight,this.factorWidth,this.factorHeight)}}}function Poster(){this.color={red:randomPick(1,255),green:randomPick(1,255),blue:randomPick(1,255),alpha:0},"random"==wall.settings.spreadMode?this.imgSrc=library[randomPick(0,library.length)].src:"shuffle"==wall.settings.spreadMode&&(shuffleCounter<library.length?(this.imgSrc=library[shuffleCounter].src,this.index=parseInt(library[shuffleCounter].id),shuffleCounter++):(shuffle(library),shuffleCounter=0,this.imgSrc=library[shuffleCounter].src,this.index=parseInt(library[shuffleCounter].id),shuffleCounter++)),this.width=50,this.height=50,this.inViewport=!1,this.blacked=!0,this.factor=1,this.time=0,this.alphaEnd=1,this.rgba,this.hovered=!1,this.fade=function(){if(0==this.inViewport&&1==this.blacked){this.rgba="rgba(0, 0, 0, 1)";var chance=randomPick(1,45-this.factor);1==chance?(this.blacked=!1,this.factor=1):this.factor++,this.inViewport=!0}else if(1==this.inViewport&&1==this.blacked){var chance=randomPick(1,45-this.factor);1==chance?(this.blacked=!1,this.factor=1):this.factor++}else 1==this.inViewport&&0==this.blacked?(this.color.alpha<1&&(this.color.alpha=easeOutCubic(this.time,0,this.alphaEnd,200),this.time++),this.rgba="rgba("+this.color.red+","+this.color.green+","+this.color.blue+","+this.color.alpha+")"):console.error("FADE PROBLEM")}}function generate(array){for(var i=0;250>i;i++){for(var col=[],j=0;250>j;j++){var poster=new Poster;col.push(poster)}array.push(col)}}function randomPick(min,max){return Math.floor(Math.random()*max)+min}function isEven(n){return n==parseFloat(n)&&!(n%2)}function text(indiceX,indiceY,x,y){ctx.font="18px Arial",ctx.fillStyle="black",ctx.fillText(indiceX+" / "+indiceY,x,y)}function shuffle(o){for(var j,x,i=o.length;i;j=Math.floor(Math.random()*i),x=o[--i],o[i]=o[j],o[j]=x);return o}function validArg(param){var valid=!0;return"undefined"===param?(console.error("Settings object is undefined"),valid=!1):null===param?(console.error("Settings object is null"),valid=!1):(!param&&Object.toType(param)&&console.log("Settings object valid"),param.hasOwnProperty("tileWidth")&&"number"!==Object.toType(param.tileWidth)&&(console.error("TileWidth is not a number"),valid=!1),param.hasOwnProperty("tileHeight")&&"number"!==Object.toType(param.tileHeight)&&(console.error("tileHeight is not a number"),valid=!1),param.hasOwnProperty("content")&&("string"!==Object.toType(param.content)?(console.error("tileHeight is not a string"),valid=!1):("image"!==param.content||"rectangle"!==param.content)&&(console.error("content : "+param.content+"is not a valid option"),valid=!1)),param.hasOwnProperty("fadeAnimation")&&("string"!==Object.toType(param.fadeAnimation)?(console.error("tileHeight is not a string"),valid=!1):"easeOutCubic"!==param.fadeAnimation&&(console.error("fadeAnimation : "+param.fadeAnimation+"is not a valid option"),valid=!1)),valid)}function validOptions(param){var valid=!0;return"undefined"===param?(console.error("Settings object is undefined"),valid=!1):null===param?(console.error("Settings object is null"),valid=!1):(!param&&Object.toType(param)&&console.log("Settings object valid"),param.hasOwnProperty("tileWidth")&&"number"!==Object.toType(param.tileWidth)&&(console.error("TileWidth is not a number"),valid=!1),param.hasOwnProperty("tileHeight")&&"number"!==Object.toType(param.tileHeight)&&(console.error("tileHeight is not a number"),valid=!1),param.hasOwnProperty("content")&&("string"!==Object.toType(param.content)?(console.error("content is not a string"),valid=!1):"image"!==param.content&&"rectangle"!==param.content&&(console.error("content : "+param.content+" is not a valid option"),valid=!1)),param.hasOwnProperty("fadeAnimation")&&("string"!==Object.toType(param.fadeAnimation)?(console.error("tileHeight is not a string"),valid=!1):"easeOutCubic"!==param.fadeAnimation&&(console.error("fadeAnimation : "+param.fadeAnimation+" is not a valid option"),valid=!1)),param.hasOwnProperty("scaleOn")&&"boolean"!==Object.toType(param.scaleOn)&&(console.error("scaleOn is not a boolean"),valid=!1),param.hasOwnProperty("scale")&&"number"!==Object.toType(param.scale)&&(console.error("scale is not a number"),valid=!1),param.hasOwnProperty("minScale")&&"number"!==Object.toType(param.minScale)&&(console.error("minScale is not a number"),valid=!1),param.hasOwnProperty("maxScale")&&"number"!==Object.toType(param.maxScale)&&(console.error("maxScale is not a number"),valid=!1),param.hasOwnProperty("spreadMode")&&("string"!==Object.toType(param.spreadMode)?(console.error("spreadMode is not a string"),valid=!1):"random"!==param.spreadMode&&"shuffle"!==param.spreadMode&&(console.error("spreadMode : "+param.spreadMode+" is not a valid option"),valid=!1)),valid)}function OpenInNewTab(url){var win=window.open(url,"_blank");win.focus()}function applyWheel(e){var evt=window.event||e,delta=evt.detail?-120*evt.detail:evt.wheelDelta;if(wall.settings.scaleOn&&(startWheel=new Date,diffWheel=(startWheel-lastWheel)/1e3,wall.scale>=wall.settings.minScale&&wall.scale<=wall.settings.maxScale)){var lastScale=wall.scale;wall.scale+=delta/2e3;var diffScale=wall.scale-lastScale;if(wall.scale<wall.settings.minScale)wall.scale=wall.settings.minScale;else if(wall.scale>wall.settings.maxScale)wall.scale=wall.settings.maxScale;else{diffScale>wall.settings.maxScale-lastScale&&(diffscale=wall.settings.maxScale-lastScale),diffScale>lastScale-wall.settings.minScale&&(diffscale=lastScale-wall.settings.minScale);var correctionX=diffScale*(wall.current.viewportX+wall.width/2),correctionY=diffScale*(wall.current.viewportY+wall.height/2);wall.current.positionX+=correctionX,wall.current.positionY+=correctionY,console.log(wall.scale+"  /  "+correctionX+"  /  "+correctionY)}}}function debug(sec){window.setInterval(function(){if(wall.scale>=wall.settings.minScale&&wall.scale<=wall.settings.maxScale){var lastScale=wall.scale;wall.scale+=.05;var diffScale=wall.scale-lastScale;wall.scale<wall.settings.minScale?wall.scale=wall.settings.minScale:wall.scale>wall.settings.maxScale?wall.scale=wall.settings.maxScale:(wall.current.positionX+=diffScale*(wall.current.positionX+wall.width/2),wall.current.positionY+=diffScale*(wall.current.positionY+wall.height/2),console.log("ZOOM : pX "+wall.current.positionX+" / diff : "+diffScale+" / corr : "+diffScale*(wall.current.positionX+wall.width/2)+" / scale : "+wall.scale))}},sec)}function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b}function easeOutQuart(t,b,c,d){return t/=d,t--,-c*(t*t*t*t-1)+b}function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b}function easeCustom(t,b,c,d){return c+Math.floor((b-c)/20)}function easeOutCubic(t,b,c,d){return t/=d,t--,c*(t*t*t+1)+b}!function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();var canvas,ctx,lastTileHovered={},lastOffsetX=1,lastPositionX=1,shuffleCounter=0,fps={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var d=(new Date).getTime(),currentTime=(d-this.startTime)/1e3,result=Math.floor(this.frameNumber/currentTime);return currentTime>1&&(this.startTime=(new Date).getTime(),this.frameNumber=0),result}};Object.toType=function(global){return function(obj){return obj===global?"global":{}.toString.call(obj).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}}(this);var el=document.getElementById("viewport"),eventHandler=new Hammer(el);eventHandler.get("pan").set({direction:Hammer.DIRECTION_ALL}),eventHandler.get("pinch").set({enable:!0}),eventHandler.get("rotate").set({enable:!0});var lastX,lastY,deltaX=0,deltaY=0,intervalCounter=0,startWheel,lastWheel,diffWheel;startWheel=lastWheel=new Date,eventHandler.on("panstart",function(e){lastX=e.center.x,lastY=e.center.y}),eventHandler.on("panmove",function(e){deltaX=lastX-e.center.x,deltaY=lastY-e.center.y,wall.current.positionX+=deltaX,wall.current.positionY+=deltaY,wall.current.viewportX+=deltaX/wall.scale,wall.current.viewportY+=deltaY/wall.scale,lastX=e.center.x,lastY=e.center.y}),eventHandler.on("panend",function(e){});var mousewheelevt=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";el.addEventListener("mouseover",function(){document.attachEvent?document.attachEvent("on"+mousewheelevt,applyWheel):document.addEventListener&&document.addEventListener(mousewheelevt,applyWheel,!1)}),eventHandler.on("tap",function(e){var target=wall.getTile(e.center.x,e.center.y);wall.onClick(target)}),el.addEventListener("mousemove",function(e){var target=wall.getTile(e.pageX,e.pageY);wall.onMouseover(target)});var pinchSensitivity=6e-5;eventHandler.on("pinchin",function(e){wall.settings.scaleOn&&wall.scale>=wall.settings.minScale&&wall.scale<=wall.settings.maxScale&&(wall.scale-=e.scale*wall.factorWidth*pinchSensitivity,wall.scale<wall.settings.minScale?wall.scale=wall.settings.minScale:wall.scale>wall.settings.maxScale?wall.scale=wall.settings.maxScale:(wall.current.positionX-=e.scale*wall.factorWidth*pinchSensitivity*wall.width/2,wall.current.positionY-=e.scale*wall.factorWidth*pinchSensitivity*wall.height/2))}),eventHandler.on("pinchout",function(e){wall.settings.scaleOn&&wall.scale>=wall.settings.minScale&&wall.scale<=wall.settings.maxScale&&(wall.scale+=e.scale*wall.factorWidth*pinchSensitivity,wall.scale<wall.settings.minScale?wall.scale=wall.settings.minScale:wall.scale>wall.settings.maxScale?wall.scale=wall.settings.maxScale:(wall.current.positionX+=e.scale*wall.factorWidth*pinchSensitivity*wall.width/2,wall.current.positionY+=e.scale*wall.factorWidth*pinchSensitivity*wall.height/2))}),$(document).keydown(function(e){switch(e.which){case 37:break;case 38:wall.scale+=.05,wall.render();break;case 39:break;case 40:wall.scale-=.05,wall.render();break;default:return}e.preventDefault()}),window.onresize=function(event){wall.updateSizeViewport()};var myInterval=0;