function Wall(id,idParent,array,params){var self=this;this.id=id,this.idParent=idParent,this.source=array,this.width=window.innerWidth,this.height=window.innerHeight,this.settings={tileWidth:300,tileHeight:400,content:"rectangle",fadeAnimation:"easeOutCubic",scaleOn:!0,scale:1,minScale:.25,maxScale:1.75,scaleSensitivity:1,spreadMode:"random",numberTile:100,startX:0,starY:0,onClickCallback:function(){console.log("click")},mouseoverCallback:function(){}},this.numberTile=this.settings.numberTile,params&&validOptions(params)?$.extend(this.settings,params):console.error("Some options are not valid"),this.updateNumberTile=function(){this.numberRow=Math.ceil(this.width/this.factorWidth)+1,this.numberCol=Math.ceil(this.height/this.factorHeight)+1},this.FPS=60,this.updateFPS=function(){this.FPS=fps.getFPS()},this.scale=this.settings.scale,this.updateScale=function(){this.factorWidth=this.settings.tileWidth*this.scale,this.factorHeight=this.settings.tileHeight*this.scale,this.current.virtualWidth=this.width/this.scale,this.current.virtualHeight=this.height/this.scale},this.updateSizeViewport=function(){this.width=canvas.width=window.innerWidth,this.height=canvas.height=window.innerHeight},this.newX=function(x){return Math.floor(x/self.factorWidth)},this.newY=function(y){return Math.floor(y/self.factorHeight)},this.current={positionX:0,positionY:0,viewportX:0,viewportY:0,time:0,identifyTile:function(x,y){var newX=self.newX(x),newY=self.newY(y),finalX=newX,finalY=newY;if(0>newX||newX>=self.numberTile){var absX=Math.abs(newX);finalX=isEven(Math.floor(absX/self.numberTile))?self.numberTile-absX:absX-self.numberTile}if(0>newY||newY>=self.numberTile){var absY=Math.abs(newY);finalY=isEven(Math.floor(absY/self.numberTile))?self.numberTile-absY:absY-self.numberTile}},getTile:function(x,y){var newX=self.newX(x),newY=self.newY(y);if(x>=0?this.offsetX=self.factorWidth-x%self.factorWidth:this.offsetX=Math.abs(x)%self.factorWidth,y>=0?this.offsetY=self.factorHeight-y%self.factorHeight:this.offsetY=Math.abs(y)%self.factorHeight,0>newX||newX>=self.numberTile){var absX=Math.abs(newX);this.tileX=isEven(Math.floor(absX/self.numberTile))?self.numberTile-absX:absX-self.numberTile}else this.tileX=newX;if(0>newY||newY>=self.numberTile){var absY=Math.abs(newY);this.tileY=isEven(Math.floor(absY/self.numberTile))?self.numberTile-absY:absY-self.numberTile}else this.tileY=newY}},this.create=function(){$("#"+idParent).html('<canvas id="'+self.id+'" width="'+self.width+'" height="'+self.height+'">'),canvas=document.getElementById(self.id),ctx=canvas.getContext("2d")},this.getTile=function(x,y){var tempX=x-this.current.offsetX,tempY=y-this.current.offsetY,newX=0,newY=0;return tempX>=0&&(newX=Math.floor(tempX/this.factorWidth+1)),tempY>=0&&(newY=Math.floor(tempY/this.factorWidth+1)),this.source[(this.current.tileX+newX)%self.numberTile][(this.current.tileY+newY)%self.numberTile]},this.onClick=function(){this.settings.onClickCallback()},this.onMouseover=function(tile){"undefined"==typeof lastTileHovered.color?(self.current.tileHoveredAlpha=1,tile.startTime=Date.now(),tile.alphaEnd=.3,tile.calculAlpha(tile.alpha,300),tile.hovered=!0,lastTileHovered=tile):tile.hovered!==lastTileHovered.hovered&&(lastTileHovered.startTime=Date.now(),lastTileHovered.alphaEnd=self.current.tileHoveredAlpha,lastTileHovered.calculAlpha(lastTileHovered.alpha,300),lastTileHovered.hovered=!1,self.current.tileHoveredAlpha=tile.color.alpha,tile.startTime=Date.now(),tile.alphaEnd=.3,tile.calculAlpha(tile.alpha,300),tile.hovered=!0,lastTileHovered=tile),this.settings.mouseoverCallback()},this.render=function(){this.updateScale(),this.updateNumberTile(),this.current.getTile(this.current.positionX,this.current.positionY),ctx.clearRect(0,0,self.width,self.height),"image"==this.settings.content?this.drawImages():"rectangle"==this.settings.content&&this.drawRectangles()},this.drawRectangles=function(){for(var i=0;i<self.numberRow;i++)for(var j=0;j<self.numberCol;j++){var x=(this.current.tileX+i)%self.numberTile,y=(this.current.tileY+j)%self.numberTile,currentPoster=this.source[x][y];currentPoster.fade(),ctx.fillStyle=currentPoster.rgba;var jTimesOffY=j*this.current.offsetY,factorOffsetLoopX=self.factorOffsetLoopX(i),factorOffsetLoopY=self.factorOffsetLoopY(j);if(1>i){var iTimeOffX=i*this.current.offsetX;1>j?(ctx.fillRect(iTimeOffX,jTimesOffY,this.current.offsetX,this.current.offsetY),text(x,y,20,20)):(ctx.fillRect(iTimeOffX,factorOffsetLoopY,this.current.offsetX,this.factorHeight),text(x,y,iTimeOffX+20,factorOffsetLoopY+20))}else 1>j?(ctx.fillRect(factorOffsetLoopX,jTimesOffY,this.factorWidth,this.current.offsetY),text(x,y,factorOffsetLoopX+20,jTimesOffY+20)):(ctx.fillRect(factorOffsetLoopX,factorOffsetLoopY,this.factorWidth,this.factorHeight),text(x,y,factorOffsetLoopX+20,factorOffsetLoopY+20))}},this.drawImages=function(){for(var i=0;i<self.numberRow;i++)for(var j=0;j<self.numberCol;j++){var x=(this.current.tileX+i)%self.numberTile,y=(this.current.tileY+j)%self.numberTile,currentPoster=this.source[x][y],img=new Image;if(img.src=currentPoster.imgSrc,currentPoster.fade(),ctx.globalAlpha=currentPoster.color.alpha,1>j)var scaleDivideOffY=this.current.offsetY/this.scale,tileHeightMinusOff=this.settings.tileHeight-scaleDivideOffY;if(1>i){var scaleDivideOffX=this.current.offsetX/this.scale,tileWidthMinusOff=this.settings.tileWidth-scaleDivideOffX;1>j?ctx.drawImage(img,tileWidthMinusOff,tileHeightMinusOff,scaleDivideOffX,scaleDivideOffY,i*this.current.offsetX,j*this.current.offsetY,this.current.offsetX,this.current.offsetY):ctx.drawImage(img,tileWidthMinusOff,0,scaleDivideOffX,this.settings.tileHeight,i*this.current.offsetX,this.factorOffsetLoopY(j),this.current.offsetX,this.factorHeight)}else 1>j?ctx.drawImage(img,0,tileHeightMinusOff,this.settings.tileWidth,scaleDivideOffY,this.factorOffsetLoopX(i),j*this.current.offsetY,this.factorWidth,this.current.offsetY):ctx.drawImage(img,0,0,this.settings.tileWidth,this.settings.tileHeight,this.factorOffsetLoopX(i),this.factorOffsetLoopY(j),this.factorWidth,this.factorHeight)}},this.factorOffsetLoopX=function(i){return this.current.offsetX+(i-1)*this.factorWidth},this.factorOffsetLoopY=function(j){return this.current.offsetY+(j-1)*this.factorHeight}}function Poster(){var self=this;this.color={red:randomPick(1,255),green:randomPick(1,255),blue:randomPick(1,255),alpha:0,rgba:function(){var c=self.color;return[c.red,c.green,c.blue,c.alpha].join(",")}},"random"==wall.settings.spreadMode?this.imgSrc=library[randomPick(0,library.length)].src:"shuffle"==wall.settings.spreadMode&&(shuffleCounter<library.length?this.imgSrc=library[shuffleCounter].src:(shuffle(library),shuffleCounter=0),this.imgSrc=library[shuffleCounter].src,shuffleCounter++),this.width=50,this.height=50,this.inViewport_bl=!1,this.blacked_bl=!0,this.factor=1,this.alphaEnd=1,this.rgba,this.hovered=!1,this.calculAlpha=function(alphaStart,time){this.time=Date.now(),this.currentTime=this.time-this.startTime,this.color.alpha=easeOutCubic(this.currentTime,alphaStart,this.alphaEnd,time),this.currentTime>1e3&&(this.color.alpha=this.alphaEnd)},this.fade=function(){if(0==this.inViewport_bl&&1==this.blacked_bl){var chance=randomPick(1,45-this.factor);1==chance?(this.blacked_bl=!1,this.factor=1):this.factor++,this.inViewport_bl=!0}else if(1==this.inViewport_bl&&1==this.blacked_bl){var chance=randomPick(1,45-this.factor);1==chance?(this.blacked_bl=!1,this.factor=1,this.startTime=Date.now()):this.factor++}else 1==this.inViewport_bl&&0==this.blacked_bl?this.color.alpha<1&&(this.calculAlpha(0,1e3),this.rgba="rgba("+this.color.rgba()+")"):console.error("FADE PROBLEM")}}function generate(array){shuffle(library);for(var i=0;i<wall.numberTile;i++){for(var col=[],j=0;j<wall.numberTile;j++){var poster=new Poster;col.push(poster)}array.push(col)}}function randomPick(min,max){return Math.floor(Math.random()*max)+min}function isEven(n){return n==parseFloat(n)&&!(n%2)}function text(indiceX,indiceY,x,y){ctx.font="18px Arial",ctx.fillStyle="black",ctx.fillText(indiceX+" / "+indiceY,x,y)}function shuffle(o){for(var j,x,i=o.length;i;j=Math.floor(Math.random()*i),x=o[--i],o[i]=o[j],o[j]=x);return o}function validArg(param){var valid=!0;return"undefined"===param?(console.error("Settings object is undefined"),valid=!1):null===param?(console.error("Settings object is null"),valid=!1):(!param&&Object.toType(param)&&console.log("Settings object valid"),param.hasOwnProperty("tileWidth")&&"number"!==Object.toType(param.tileWidth)&&(console.error("TileWidth is not a number"),valid=!1),param.hasOwnProperty("tileHeight")&&"number"!==Object.toType(param.tileHeight)&&(console.error("tileHeight is not a number"),valid=!1),param.hasOwnProperty("content")&&("string"!==Object.toType(param.content)?(console.error("tileHeight is not a string"),valid=!1):("image"!==param.content||"rectangle"!==param.content)&&(console.error("content : "+param.content+"is not a valid option"),valid=!1)),param.hasOwnProperty("fadeAnimation")&&("string"!==Object.toType(param.fadeAnimation)?(console.error("tileHeight is not a string"),valid=!1):"easeOutCubic"!==param.fadeAnimation&&(console.error("fadeAnimation : "+param.fadeAnimation+"is not a valid option"),valid=!1)),valid)}function validOptions(param){var valid=!0;return"undefined"===param?(console.error("Settings object is undefined"),valid=!1):null===param?(console.error("Settings object is null"),valid=!1):(!param&&Object.toType(param)&&console.log("Settings object valid"),param.hasOwnProperty("tileWidth")&&"number"!==Object.toType(param.tileWidth)&&(console.error("TileWidth is not a number"),valid=!1),param.hasOwnProperty("tileHeight")&&"number"!==Object.toType(param.tileHeight)&&(console.error("tileHeight is not a number"),valid=!1),param.hasOwnProperty("content")&&("string"!==Object.toType(param.content)?(console.error("content is not a string"),valid=!1):"image"!==param.content&&"rectangle"!==param.content&&(console.error("content : "+param.content+" is not a valid option"),valid=!1)),param.hasOwnProperty("fadeAnimation")&&("string"!==Object.toType(param.fadeAnimation)?(console.error("tileHeight is not a string"),valid=!1):"easeOutCubic"!==param.fadeAnimation&&(console.error("fadeAnimation : "+param.fadeAnimation+" is not a valid option"),valid=!1)),param.hasOwnProperty("scaleOn")&&"boolean"!==Object.toType(param.scaleOn)&&(console.error("scaleOn is not a boolean"),valid=!1),param.hasOwnProperty("scale")&&"number"!==Object.toType(param.scale)&&(console.error("scale is not a number"),valid=!1),param.hasOwnProperty("minScale")&&"number"!==Object.toType(param.minScale)&&(console.error("minScale is not a number"),valid=!1),param.hasOwnProperty("maxScale")&&"number"!==Object.toType(param.maxScale)&&(console.error("maxScale is not a number"),valid=!1),param.hasOwnProperty("spreadMode")&&("string"!==Object.toType(param.spreadMode)?(console.error("spreadMode is not a string"),valid=!1):"random"!==param.spreadMode&&"shuffle"!==param.spreadMode&&(console.error("spreadMode : "+param.spreadMode+" is not a valid option"),valid=!1)),param.hasOwnProperty("numberTile")&&"number"!==Object.toType(param.numberTile)&&(console.error("numberTile is not a number"),valid=!1),param.hasOwnProperty("onClickCallback")&&"function"!==Object.toType(param.onClickCallback)&&(console.error("onClickCallback is not a function"),valid=!1),param.hasOwnProperty("mouseoverCallback")&&"function"!==Object.toType(param.mouseoverCallback)&&(console.error("mouseoverCallback is not a function"),valid=!1),valid)}function OpenInNewTab(url){var win=window.open(url,"_blank");win.focus()}function applyWheel(e){var evt=window.event||e,delta=evt.detail?-120*evt.detail:evt.wheelDelta;if(wall.settings.scaleOn&&(startWheel=new Date,diffWheel=(startWheel-lastWheel)/1e3,wall.scale>=wall.settings.minScale&&wall.scale<=wall.settings.maxScale)){var lastScale=wall.scale;wall.scale+=delta/2e3;var diffScale=wall.scale-lastScale;if(wall.scale<wall.settings.minScale)wall.scale=wall.settings.minScale;else if(wall.scale>wall.settings.maxScale)wall.scale=wall.settings.maxScale;else{diffScale>wall.settings.maxScale-lastScale&&(diffscale=wall.settings.maxScale-lastScale),diffScale>lastScale-wall.settings.minScale&&(diffscale=lastScale-wall.settings.minScale);var correctionX=diffScale*(wall.current.viewportX+wall.width/2),correctionY=diffScale*(wall.current.viewportY+wall.height/2);wall.current.positionX+=correctionX,wall.current.positionY+=correctionY,console.log(wall.scale+"  /  "+correctionX+"  /  "+correctionY)}}}function debug(sec){window.setInterval(function(){if(wall.scale>=wall.settings.minScale&&wall.scale<=wall.settings.maxScale){var current=wallContent[0][0];console.log("alphaEnd : "+current.aplhaEnd+" / rgba : "+current.rgba+" / time : "+current.time)}},sec)}function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b}function easeOutQuart(t,b,c,d){return t/=d,t--,-c*(t*t*t*t-1)+b}function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b}function easeCustom(t,b,c,d){return c+Math.floor((b-c)/20)}function easeOutCubic(t,b,c,d){return t/=d,t--,c*(t*t*t+1)+b}!function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();var canvas,ctx,lastTileHovered={},lastOffsetX=1,lastPositionX=1,shuffleCounter=0,fps={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var d=(new Date).getTime(),currentTime=(d-this.startTime)/1e3,result=Math.floor(this.frameNumber/currentTime);return currentTime>1&&(this.startTime=(new Date).getTime(),this.frameNumber=0),result}};Object.toType=function(global){return function(obj){return obj===global?"global":{}.toString.call(obj).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}}(this);var el=document.getElementById("viewport"),eventHandler=new Hammer(el);eventHandler.get("pan").set({direction:Hammer.DIRECTION_ALL}),eventHandler.get("pinch").set({enable:!0}),eventHandler.get("rotate").set({enable:!0});var lastX,lastY,deltaX=0,deltaY=0,intervalCounter=0,startWheel,lastWheel,diffWheel;startWheel=lastWheel=new Date,eventHandler.on("panstart",function(e){lastX=e.center.x,lastY=e.center.y}),eventHandler.on("panmove",function(e){deltaX=lastX-e.center.x,deltaY=lastY-e.center.y,wall.current.positionX+=deltaX,wall.current.positionY+=deltaY,wall.current.viewportX+=deltaX/wall.scale,wall.current.viewportY+=deltaY/wall.scale,lastX=e.center.x,lastY=e.center.y}),eventHandler.on("panend",function(e){});var mousewheelevt=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";el.addEventListener("mouseover",function(){document.attachEvent?document.attachEvent("on"+mousewheelevt,applyWheel):document.addEventListener&&document.addEventListener(mousewheelevt,applyWheel,!1)}),eventHandler.on("tap",function(e){var target=wall.getTile(e.center.x,e.center.y);wall.onClick(target)}),el.addEventListener("mousemove",function(e){var target=wall.getTile(e.pageX,e.pageY);wall.onMouseover(target)});var pinchSensitivity=6e-5;eventHandler.on("pinchin",function(e){wall.settings.scaleOn&&wall.scale>=wall.settings.minScale&&wall.scale<=wall.settings.maxScale&&(wall.scale-=e.scale*wall.factorWidth*pinchSensitivity,wall.scale<wall.settings.minScale?wall.scale=wall.settings.minScale:wall.scale>wall.settings.maxScale?wall.scale=wall.settings.maxScale:(wall.current.positionX-=e.scale*wall.factorWidth*pinchSensitivity*wall.width/2,wall.current.positionY-=e.scale*wall.factorWidth*pinchSensitivity*wall.height/2))}),eventHandler.on("pinchout",function(e){wall.settings.scaleOn&&wall.scale>=wall.settings.minScale&&wall.scale<=wall.settings.maxScale&&(wall.scale+=e.scale*wall.factorWidth*pinchSensitivity,wall.scale<wall.settings.minScale?wall.scale=wall.settings.minScale:wall.scale>wall.settings.maxScale?wall.scale=wall.settings.maxScale:(wall.current.positionX+=e.scale*wall.factorWidth*pinchSensitivity*wall.width/2,wall.current.positionY+=e.scale*wall.factorWidth*pinchSensitivity*wall.height/2))}),$(document).keydown(function(e){switch(e.which){case 37:break;case 38:break;case 39:break;case 40:break;default:return}e.preventDefault()}),window.onresize=function(event){wall.updateSizeViewport()};var myInterval=0;