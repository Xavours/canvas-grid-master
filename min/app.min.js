function Wall(id,idParent,array,params){var self=this;this.id=id,this.idParent=idParent,this.source=array,this.width=$(window).width(),this.height=$(window).height(),this.settings={tileWidth:300,tileHeight:400,content:"image",fadeAnimation:"easeOutCubic"},params&&validOption(params)?$.extend(this.settings,params):console.error("problem"),this.updateNumberTile=function(){this.numberRow=Math.ceil(this.width/this.factorWidth)+1,this.numberCol=Math.ceil(this.height/this.factorHeight)+1},this.scale=1,this.updateScale=function(){this.factorWidth=this.settings.tileWidth*this.scale,this.factorHeight=this.settings.tileHeight*this.scale},this.viewport={minX:0,minY:0,maxX:self.width,maxY:self.height},this.updateViewport=function(){this.factorWidth=this.settings.tileWidth*this.scale,this.factorHeight=this.settings.tileHeight*this.scale},this.current={positionX:Math.floor(self.width/2),positionY:Math.floor(self.height/2),getTile:function(x,y){this.tileX=Math.floor(x/self.factorWidth)+1,this.offsetX=self.factorWidth-x%self.factorWidth,this.tileY=Math.floor(y/self.factorHeight)+1,this.offsetY=self.factorHeight-y%self.factorHeight}},this.create=function(){$("#"+idParent).html('<canvas id="'+self.id+'" width="'+self.width+'" height="'+self.height+'">'),canvas=document.getElementById(self.id),ctx=canvas.getContext("2d")},this.getTileClicked=function(mouseX,mouseY){if(mouseX<this.current.offsetX)var tileX=0;else var tileX=Math.floor((mouseX-this.current.offsetX)/this.factorWidth+1);if(mouseY<this.current.offsetY)var tileY=0;else var tileY=Math.floor((mouseY-this.current.offsetY)/this.factorHeight+1);return console.log(tileX+" / "+tileY),this.source[tileY]},this.render=function(){this.updateScale(),this.updateNumberTile(),this.current.getTile(this.current.positionX,this.current.positionY),ctx.clearRect(0,0,self.width,self.height),"image"==this.settings.content&&this.drawImages(),"rectangle"==this.settings.content&&this.drawRectangles()},this.drawRectangles=function(){for(var i=0;i<self.numberRow;i++)for(var j=0;j<self.numberCol;j++){var currentPoster=this.source[this.current.tileX+i][this.current.tileY+j];currentPoster.fade(),ctx.fillStyle=currentPoster.rgba,1>i?1>j?ctx.fillRect(i*this.current.offsetX,j*this.current.offsetY,this.current.offsetX,this.current.offsetY):ctx.fillRect(i*this.current.offsetX,this.current.offsetY+(j-1)*self.factorHeight,this.current.offsetX,self.factorHeight):1>j?ctx.fillRect(this.current.offsetX+(i-1)*self.factorWidth,j*this.current.offsetY,self.factorWidth,this.current.offsetY):ctx.fillRect(this.current.offsetX+(i-1)*self.factorWidth,this.current.offsetY+(j-1)*self.factorHeight,self.factorWidth,self.factorHeight)}},this.drawImages=function(){for(var i=0;i<self.numberRow;i++)for(var j=0;j<self.numberCol;j++){var currentPoster=this.source[this.current.tileX+i][this.current.tileY+j];img=library[currentPoster.image.src],currentPoster.fade(),ctx.globalAlpha=currentPoster.color.alpha,1>i?1>j?ctx.drawImage(img,this.settings.tileWidth-this.current.offsetX,this.settings.tileHeight-this.current.offsetY,this.current.offsetX,this.current.offsetY,i*this.current.offsetX,j*this.current.offsetY,this.current.offsetX,this.current.offsetY):ctx.drawImage(img,this.settings.tileWidth-this.current.offsetX,0,this.current.offsetX,this.settings.tileHeight,i*this.current.offsetX,this.current.offsetY+(j-1)*self.factorHeight,this.current.offsetX,self.factorHeight):1>j?ctx.drawImage(img,0,this.settings.tileHeight-this.current.offsetY,this.settings.tileWidth,this.current.offsetY,this.current.offsetX+(i-1)*self.factorWidth,j*this.current.offsetY,self.factorWidth,this.current.offsetY):ctx.drawImage(img,0,0,this.settings.tileWidth,this.settings.tileHeight,this.current.offsetX+(i-1)*self.factorWidth,this.current.offsetY+(j-1)*self.factorHeight,self.factorWidth,self.factorHeight)}}}function Poster(){this.color={red:randomPick(1,255),green:randomPick(1,255),blue:randomPick(1,255),alpha:0},this.image={src:randomPick(0,library.length)},this.width=50,this.height=50,this.inViewport=!1,this.blacked=!0,this.factor=1,this.time=0,this.rgba,this.fade=function(){if(0==this.inViewport&&1==this.blacked){this.rgba="rgba(0, 0, 0, 1)";var chance=randomPick(1,45-this.factor);1==chance?(this.blacked=!1,this.factor=1):this.factor++,this.inViewport=!0}else if(1==this.inViewport&&1==this.blacked){var chance=randomPick(1,45-this.factor);1==chance?(this.blacked=!1,this.factor=1):this.factor++}else 1==this.inViewport&&0==this.blacked?(this.color.alpha<1&&(this.color.alpha=easeOutCubic(this.time,0,1,600),this.time++),this.rgba="rgba("+this.color.red+","+this.color.green+","+this.color.blue+","+this.color.alpha+")"):console.error("FADE PROBLEM")}}function generate(array){for(var i=0;250>i;i++){for(var col=[],j=0;250>j;j++){var poster=new Poster;col.push(poster)}array.push(col)}}function randomPick(min,max){return Math.floor(Math.random()*max)+min}function validArg(param){var valid=!0;return"undefined"===param?(console.error("Settings object is undefined"),valid=!1):null===param?(console.error("Settings object is null"),valid=!1):(!param&&Object.toType(param)&&console.log("Settings object valid"),param.hasOwnProperty("tileWidth")&&"number"!==Object.toType(param.tileWidth)&&(console.error("TileWidth is not a number"),valid=!1),param.hasOwnProperty("tileHeight")&&"number"!==Object.toType(param.tileHeight)&&(console.error("tileHeight is not a number"),valid=!1),param.hasOwnProperty("content")&&("string"!==Object.toType(param.content)?(console.error("tileHeight is not a string"),valid=!1):("image"!==param.content||"rectangle"!==param.content)&&(console.error("content : "+param.content+"is not a valid option"),valid=!1)),param.hasOwnProperty("fadeAnimation")&&("string"!==Object.toType(param.fadeAnimation)?(console.error("tileHeight is not a string"),valid=!1):"easeOutCubic"!==param.fadeAnimation&&(console.error("fadeAnimation : "+param.fadeAnimation+"is not a valid option"),valid=!1)),valid)}function validOption(param){var valid=!0;return"undefined"===param?(console.error("Settings object is undefined"),valid=!1):null===param?(console.error("Settings object is null"),valid=!1):(!param&&Object.toType(param)&&console.log("Settings object valid"),param.hasOwnProperty("tileWidth")&&"number"!==Object.toType(param.tileWidth)&&(console.error("TileWidth is not a number"),valid=!1),param.hasOwnProperty("tileHeight")&&"number"!==Object.toType(param.tileHeight)&&(console.error("tileHeight is not a number"),valid=!1),param.hasOwnProperty("content")&&("string"!==Object.toType(param.content)?(console.error("tileHeight is not a string"),valid=!1):("image"!==param.content||"rectangle"!==param.content)&&(console.error("content : "+param.content+"is not a valid option"),valid=!1)),param.hasOwnProperty("fadeAnimation")&&("string"!==Object.toType(param.fadeAnimation)?(console.error("tileHeight is not a string"),valid=!1):"easeOutCubic"!==param.fadeAnimation&&(console.error("fadeAnimation : "+param.fadeAnimation+"is not a valid option"),valid=!1)),valid)}function OpenInNewTab(url){var win=window.open(url,"_blank");win.focus()}function getMouseCoord(e){mouseX=e.x,mouseY=e.y}function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b}function easeOutQuart(t,b,c,d){return t/=d,t--,-c*(t*t*t*t-1)+b}function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b}function easeCustom(t,b,c,d){return c+Math.floor((b-c)/20)}function easeOutCubic(t,b,c,d){return t/=d,t--,c*(t*t*t+1)+b}!function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();var canvas,ctx;Object.toType=function(global){return function(obj){return obj===global?"global":{}.toString.call(obj).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}}(this),$(document).keydown(function(e){switch(e.which){case 37:break;case 38:wall.scale+=.05,wall.render();break;case 39:break;case 40:wall.scale-=.05,wall.render();break;default:return}e.preventDefault()});var flag=0,mousedown=!1,mouseup=!1,rectHits=[],mouseX,mouseY,deltaX=0,deltaY=0;document.addEventListener("mousedown",function(e){flag=0,mousedown=!0,mouseup=!1,getMouseCoord(e),console.log("down")},!1),document.addEventListener("mousemove",function(e){if(flag=1,mousedown&&!mouseup){var lastmouseX=mouseX,lastmouseY=mouseY;getMouseCoord(e),deltaX=mouseX-lastmouseX,deltaY=mouseY-lastmouseY,wall.current.positionX+=-deltaX,wall.current.positionY+=-deltaY,wall.render(posters)}(20>mouseX||20>mouseY||mouseX>ctx.canvas.width-20||mouseY>ctx.canvas.height-20)&&(mousedown=!1,mouseup=!0)},!1),document.addEventListener("mouseup",function(e){if(mousedown=!1,mouseup=!0,0===flag){var target=wall.getTileClicked(mouseX,mouseY);console.log(target),OpenInNewTab(target.image.src)}else 1===flag&&console.log("drag done")},!1);