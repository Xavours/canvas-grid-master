function Poster(){this.image=library[randomPick(0,library.length-1)].src}function randomPick(min,max){return Math.floor(Math.random()*max)+min}!function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}(),Object.prototype.clone=function(){var newObj=this instanceof Array?[]:{};for(var i in this)"clone"!==i&&(this[i]&&"object"==typeof this[i]?newObj[i]=this[i].clone():newObj[i]=this[i]);return newObj};var library=[],rects=[],imageId,flag=0,mousedown=!1,mouseup=!1,rectHits=[],mouseX,mouseY;window.onload=function(){function draw(){ctx.clearRect(0,0,windowWidth,windowHeight);for(var i=rects.length-1;i>=0;i--){var img=new Image;img.src=rects[i].image,ctx.drawImage(img,rects[i].tlX,rects[i].tlY,rectSize,rectSize)}}function update(){zoom(),draw(),restack();for(var i=rects.length-1;i>=0;i--)rects[i].tlX=easeCustom(1,rectsClone[i].tlX,rects[i].tlX,60),rects[i].tlY=easeCustom(1,rectsClone[i].tlY,rects[i].tlY,60);requestAnimationFrame(update)}function OpenInNewTab(url){var win=window.open(url,"_blank");win.focus()}function getMouseCoord(e){mouseX=e.x,mouseY=e.y}function getImageId(x,y){var colPos=x/rectSize,rowPos=y/rectSize,decY=colPos%1,decX=rowPos%1,sidePos=Math.ceil(decY+decX);imageId=Math.floor(rowPos)*cols+Math.ceil(colPos),imageId=cols*rows-imageId,console.log("Id: "+imageId+" / Side: "+sidePos)}function zoomAdd(zoomAmount){var amount=(Math.abs(zoomAmount[0])+Math.abs(zoomAmount[1]))/2e3;.06>zoomBuffer&&(zoomBuffer+=amount)}function zoom(){var neg=0,pos=0;zoomBuffer>0&&currentScale>.6&&(neg=zoomBuffer/2,zoomBuffer-=neg),1>currentScale&&(pos=.02),targetZoom+=neg-pos;var scale=targetZoom/5*(2*currentScale);prevScale=scale,currentScale=currentScale+pos-neg,targetZoom-=scale,ctx.scale(1-scale,1-scale)}function restack(){for(var i=rects.length-1;i>=0;i--){var x=rects[i].tlX,y=rects[i].tlY;restackPointL>x?moveRectRight(i):x>restackPointR&&moveRectLeft(i),-rectSize>y?moveRectDown(i):y>restackPointB&&moveRectUp(i)}}function moveRectRight(i){var offset=rectSize*cols;rects[i].tlX+=offset,rectsClone[i].tlX+=offset}function moveRectLeft(i){var offset=rectSize*cols;rects[i].tlX-=offset,rectsClone[i].tlX-=offset}function moveRectDown(i){var offset=rectSize*cols;rects[i].tlY+=offset,rectsClone[i].tlY+=offset}function moveRectUp(i){var offset=rectSize*cols;rects[i].tlY-=offset,rectsClone[i].tlY-=offset}function easeCustom(t,b,c,d){return c+Math.floor((b-c)/20)}library=$(".library"),console.log("We are ready!");c=document.getElementById("c"),ctx=c.getContext("2d");var windowWidth=window.innerWidth,windowHeight=window.innerHeight;ctx.canvas.width=windowWidth,ctx.canvas.height=windowHeight,window.onresize=function(e){windowWidth=window.innerWidth,windowHeight=window.innerHeight,ctx.canvas.width=windowWidth,ctx.canvas.height=windowHeight};for(var rectSize=300,cols=10,rows=10,nOfRects=cols*rows,i=nOfRects-1;i>=0;i--){rects[i]=new Poster;var x=(cols-i%cols)*rectSize-rectSize,y=(rows-Math.floor(i/cols))*rectSize-rectSize;rects[i].tlX=x,rects[i].tlY=y}var rectsClone=rects.clone();requestAnimationFrame(update),c.addEventListener("mousedown",function(e){flag=0,mousedown=!0,mouseup=!1,getMouseCoord(e)},!1),c.addEventListener("mousemove",function(e){if(flag=1,mousedown&&!mouseup){var lastmouseX=mouseX,lastmouseY=mouseY;getMouseCoord(e);for(var deltaX=mouseX-lastmouseX,deltaY=mouseY-lastmouseY,i=rects.length-1;i>=0;i--)rectsClone[i].tlX+=deltaX,rectsClone[i].tlY+=deltaY}console.log(mouseX+" / "+ctx.canvas.width),(20>mouseX||20>mouseY||mouseX>ctx.canvas.width-20||mouseY>ctx.canvas.height-20)&&(mousedown=!1,mouseup=!0)},!1),c.addEventListener("mouseup",function(e){mousedown=!1,mouseup=!0,0===flag?(console.log("click"),getImageId(mouseX,mouseY),OpenInNewTab(rects[imageId].image)):1===flag&&console.log("drag done")},!1);$(".container").bind("mousewheel",function(e){console.log(e.originalEvent.wheelDelta),zoomAdd([1,e.originalEvent.wheelDelta]);for(var i=rects.length-1;i>=0;i--)rectsClone[i].tlX,rectsClone[i].tlY});var zoomBuffer=1e-8,targetZoom=0,prevScale=1,currentScale=1,restackPointL=-rectSize,restackPointR=rectSize*cols-rectSize,restackPointB=rectSize*cols-rectSize-2};