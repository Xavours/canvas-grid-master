/*! canvas-grid-master - v1.0.0 - 2017-06-16
* https://github.com/Xavours/canvas-grid-master#readme
* Copyright (c) 2017 ; Licensed MIT */
function Wall(a,b,c,d){var e=this;this.id=a,this.wrapper=b,this.source=c,this.width=window.innerWidth,this.height=window.innerHeight,this.library=[],this.settings={tileWidth:300,tileHeight:400,content:"image",grayScaleOn:!1,fadeAnimation:"easeOutCubic",controller:"mouse",moveStep:10,scaleOn:!0,scale:1,minScale:.25,maxScale:1.75,scaleSensitivity:1,spreadMode:"random",numberTile:100,startX:0,starY:0,onClickCallback:function(){console.log("click")},mouseoverCallback:function(a){e.onMouseover(a)},onPressButton1Callback:function(){},onPressButton2Callback:function(){},onPressButton3Callback:function(){},onPressButton4Callback:function(){},onPressDPadUpCallback:function(){},onPressDPadDownCallback:function(){},onPressDPadLeftCallback:function(){},onPressDPadRightCallback:function(){},onPressStartCallback:function(){},onPressSelectCallback:function(){}},"string"!==Object.toType(this.id)&&console.error("Argument missing : id must be a string."),"string"!==Object.toType(this.wrapper)&&"string"!==Object.toType(param.content)&&console.error("Argument missing : wrapper must be a string."),"htmlcollection"!==Object.toType(this.source)?console.error("Argument missing : library must be an HTMLcollection containing image objects."):("undefined"==typeof this.source||0==this.source.length)&&console.error("The wall cannot be loaded cause an argument is empty or undefined : library must be an HTMLcollection containing image objects."),d&&validOptions(d)?$.extend(this.settings,d):console.error("The wall cannot be loaded because some options are not valid"),this.updateNumberTile=function(){e.numberRow=Math.ceil(e.width/e.factorWidth)+1,e.numberCol=Math.ceil(e.height/e.factorHeight)+1},this.FPS=60,this.updateFPS=function(){e.FPS=fps.getFPS()},this.scale=this.settings.scale,this.updateScale=function(){e.factorWidth=e.settings.tileWidth*e.scale,e.factorHeight=e.settings.tileHeight*e.scale,e.current.virtualWidth=e.width/e.scale,e.current.virtualHeight=e.height/e.scale},this.updateSizeViewport=function(){e.width=canvas.width=window.innerWidth,e.height=canvas.height=window.innerHeight},this.newX=function(a){return Math.floor(a/e.factorWidth)},this.newY=function(a){return Math.floor(a/e.factorHeight)},this.current={positionX:0,positionY:0,viewportX:0,viewportY:0,time:0,identifyTile:function(a,b){var c=e.newX(a),d=e.newY(b),f=c,g=d;if(0>c||c>=e.settings.numberTile){var h=Math.abs(c);f=isEven(Math.floor(h/e.settings.numberTile))?e.settings.numberTile-h:h-e.settings.numberTile}if(0>d||d>=e.settings.numberTile){var i=Math.abs(d);g=isEven(Math.floor(i/e.settings.numberTile))?e.settings.numberTile-i:i-e.settings.numberTile}},getTile:function(a,b){var c=e.newX(a),d=e.newY(b);if(a>=0?this.offsetX=e.factorWidth-a%e.factorWidth:this.offsetX=Math.abs(a)%e.factorWidth,b>=0?this.offsetY=e.factorHeight-b%e.factorHeight:this.offsetY=Math.abs(b)%e.factorHeight,0>c||c>=e.settings.numberTile){var f=Math.abs(c);this.tileX=isEven(Math.floor(f/e.settings.numberTile))?e.settings.numberTile-f:f-e.settings.numberTile}else this.tileX=c;if(0>d||d>=e.settings.numberTile){var g=Math.abs(d);this.tileY=isEven(Math.floor(g/e.settings.numberTile))?e.settings.numberTile-g:g-e.settings.numberTile}else this.tileY=d}},this.init=function(){e.generateLibrary(e.source),e.create(),e.play()},this.generateLibrary=function(a){e.library=[],shuffle(a);for(var b=0;b<e.settings.numberTile;b++){for(var c=[],d=0;d<e.settings.numberTile;d++){var f=new Poster(a);c.push(f)}e.library.push(c)}},this.create=function(){$("#"+e.wrapper).html('<canvas id="'+e.id+'" width="'+e.width+'" height="'+e.height+'">'),canvas=document.getElementById(e.id),ctx=canvas.getContext("2d"),e.setTrigger()},this.destroy=function(){$("#"+e.wrapper).html("")},this.play=function(){e.render(),playRaf(e.play)},this.pause=function(){cancelAnimationFrame(request)},this.getTile=function(a,b){var c=a-e.current.offsetX,d=b-e.current.offsetY,f=0,g=0;return c>=0&&(f=Math.floor(c/e.factorWidth+1)),d>=0&&(g=Math.floor(d/e.factorHeight+1)),e.library[(e.current.tileX+f)%e.settings.numberTile][(e.current.tileY+g)%e.settings.numberTile]},this.onClick=function(a){e.settings.onClickCallback(a)},this.onMouseover=function(a){"undefined"==typeof lastTileHovered.color?(e.current.tileHoveredAlpha=1,a.startTime=Date.now(),a.alphaEnd=.3,a.alphaStart=a.color.alpha,a.alphaComplete_bl=!1,a.hovered=!0,lastTileHovered=a):a.hovered!==lastTileHovered.hovered&&(lastTileHovered.startTime=Date.now(),lastTileHovered.alphaEnd=e.current.tileHoveredAlpha,lastTileHovered.alphaStart=lastTileHovered.color.alpha,lastTileHovered.alphaComplete_bl=!1,lastTileHovered.hovered=!1,e.current.tileHoveredAlpha=a.color.alpha,a.startTime=Date.now(),a.alphaEnd=.3,a.alphaStart=a.color.alpha,a.alphaComplete_bl=!1,a.hovered=!0,lastTileHovered=a)},this.tileBlink=function(a){e.settings.onClickCallback(a)},this.goScale=function(a){if(e.settings.scaleOn&&e.scale>=e.settings.minScale&&e.scale<=e.settings.maxScale){var b=e.scale;e.scale+=a/2e3;var c=e.scale-b;if(e.scale<e.settings.minScale)e.scale=e.settings.minScale;else if(e.scale>e.settings.maxScale)e.scale=e.settings.maxScale;else{c>e.settings.maxScale-b&&(diffscale=e.settings.maxScale-b),c>b-e.settings.minScale&&(diffscale=b-e.settings.minScale);var d=c*(e.current.viewportX+e.width/2),f=c*(e.current.viewportY+e.height/2);e.current.positionX+=d,e.current.positionY+=f}}},this.goTranslate=function(a,b){e.current.positionX+=a,e.current.positionY+=b,e.current.viewportX+=a/e.scale,e.current.viewportY+=b/e.scale},this.render=function(){e.updateScale(),e.updateNumberTile(),e.current.getTile(e.current.positionX,e.current.positionY),ctx.clearRect(0,0,e.width,e.height),"image"==e.settings.content&&e.drawImages(),"image"==e.settings.content&e.settings.grayScaleOn?e.grayScale():"rectangle"==e.settings.content&&e.drawRectangles()},this.drawRectangles=function(){for(var a=0;a<e.numberRow;a++)for(var b=0;b<e.numberCol;b++){var c=(e.current.tileX+a)%e.settings.numberTile,d=(e.current.tileY+b)%e.settings.numberTile,f=e.source[c][d];f.fade(),ctx.fillStyle=f.rgba;var g=b*e.current.offsetY,h=e.factorOffsetLoopX(a),i=e.factorOffsetLoopY(b);if(1>a){var j=a*e.current.offsetX;1>b?(ctx.fillRect(j,g,e.current.offsetX,e.current.offsetY),text(c,d,20,20)):(ctx.fillRect(j,i,e.current.offsetX,e.factorHeight),text(c,d,j+20,i+20))}else 1>b?(ctx.fillRect(h,g,e.factorWidth,e.current.offsetY),text(c,d,h+20,g+20)):(ctx.fillRect(h,i,e.factorWidth,e.factorHeight),text(c,d,h+20,i+20))}},this.drawImages=function(){for(var a=0;a<e.numberRow;a++)for(var b=0;b<e.numberCol;b++){var c=(e.current.tileX+a)%e.settings.numberTile,d=(e.current.tileY+b)%e.settings.numberTile,f=e.library[c][d],g=new Image;if(g.src=f.imgSrc,f.fade(),ctx.globalAlpha=f.color.alpha,1==f.focus&&(ctx.globalAlpha=.3),1>b)var h=e.current.offsetY/e.scale,i=e.settings.tileHeight-h;if(1>a){var j=e.current.offsetX/e.scale,k=e.settings.tileWidth-j;1>b?ctx.drawImage(g,k,i,j,h,a*e.current.offsetX,b*e.current.offsetY,e.current.offsetX,e.current.offsetY):ctx.drawImage(g,k,0,j,e.settings.tileHeight,a*e.current.offsetX,e.factorOffsetLoopY(b),e.current.offsetX,e.factorHeight)}else 1>b?ctx.drawImage(g,0,i,e.settings.tileWidth,h,e.factorOffsetLoopX(a),b*e.current.offsetY,e.factorWidth,e.current.offsetY):ctx.drawImage(g,0,0,e.settings.tileWidth,e.settings.tileHeight,e.factorOffsetLoopX(a),e.factorOffsetLoopY(b),e.factorWidth,e.factorHeight)}},this.grayScale=function(){this.imageData=ctx.getImageData(0,0,e.width,e.height);for(var a=this.imageData.data,b=0;b<a.length;b+=4){var c=.34*a[b]+.5*a[b+1]+.16*a[b+2];a[b]=c,a[b+1]=c,a[b+2]=c}ctx.putImageData(this.imageData,0,0)},this.factorOffsetLoopX=function(a){return e.current.offsetX+(a-1)*e.factorWidth},this.factorOffsetLoopY=function(a){return e.current.offsetY+(a-1)*e.factorHeight}}function Poster(a){var b=this;this.source=a,this.color={red:randomPick(1,255),green:randomPick(1,255),blue:randomPick(1,255),alpha:0,rgba:function(){var a=b.color;return[a.red,a.green,a.blue,a.alpha].join(",")}},this.width=50,this.height=50,this.inViewport_bl=!1,this.blacked_bl=!0,this.factor=1,this.alphaStart=0,this.alphaEnd=1,this.alphaComplete_bl=!1,this.alphaDelta,this.rgba,this.hovered=!1,this.focus=!1,"random"==wall.settings.spreadMode?this.imgSrc=this.source[randomPick(0,this.source.length)].src:"shuffle"==wall.settings.spreadMode&&(shuffleCounter==this.source.length&&(shuffle(this.source),shuffleCounter=0),"function"===Object.toType(this.addKeys)&&this.addKeys(),this.imgSrc=this.source[shuffleCounter].src,shuffleCounter++),this.calculAlpha=function(){this.alphaDelta=this.alphaEnd-this.alphaStart,this.time=Date.now(),this.currentTime=this.time-this.startTime,this.color.alpha=easeOutCubic(this.currentTime,this.alphaStart,this.alphaDelta,1e3),this.currentTime>1e3&&(this.color.alpha=this.alphaEnd,this.alphaComplete_bl=!0)},this.fade=function(){if(0==this.inViewport_bl&&1==this.blacked_bl){var a=randomPick(1,45-this.factor);1==a?(this.blacked_bl=!1,this.factor=1):this.factor++,this.inViewport_bl=!0}else if(1==this.inViewport_bl&&1==this.blacked_bl){var a=randomPick(1,45-this.factor);1==a?(this.blacked_bl=!1,this.factor=1,this.startTime=Date.now()):this.factor++}else!this.inViewport_bl||this.blacked_bl||this.alphaComplete_bl||(this.calculAlpha(),this.rgba="rgba("+this.color.rgba()+")")}}function debug(a){myInterval>0&&clearInterval(myInterval),myInterval=setInterval("doSomething(tile)",iFrequency)}function doSomething(a){console.log("alpha : "+a.color.alpha)}function stop(){clearInterval(myInterval)}function playRaf(a){request=requestAnimationFrame(a)}function pauseRaf(){cancelAnimationFrame(request)}function isInPage(a){return a===document.body?!1:document.body.contains(a)}function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function randomPick(a,b){return Math.floor(Math.random()*b)+a}function isEven(a){return a==parseFloat(a)&&!(a%2)}function text(a,b,c,d){ctx.font="18px Arial",ctx.fillStyle="black",ctx.fillText(a+" / "+b,c,d)}function validOptions(a){var b=!0;return"undefined"===a?(console.error("Settings object is undefined"),b=!1):null===a?(console.error("Settings object is null"),b=!1):(!a&&Object.toType(a)&&console.log("Settings object valid"),a.hasOwnProperty("tileWidth")&&"number"!==Object.toType(a.tileWidth)&&(console.error('The option "tileWidth" must be a number'),b=!1),a.hasOwnProperty("tileHeight")&&"number"!==Object.toType(a.tileHeight)&&(console.error('The option "tileHeight" must be a number'),b=!1),a.hasOwnProperty("content")&&("string"!==Object.toType(a.content)?(console.error('The option "content" must be a string'),b=!1):"image"!==a.content&&"rectangle"!==a.content&&(console.error('The option "content" : '+a.content+" is not a valid"),b=!1)),a.hasOwnProperty("grayScaleOn")&&"boolean"!==Object.toType(a.scaleOn)&&(console.error("scaleOn must be a boolean"),b=!1),a.hasOwnProperty("fadeAnimation")&&("string"!==Object.toType(a.fadeAnimation)?(console.error('The option "fadeAnimation" must be a string'),b=!1):"easeOutCubic"!==a.fadeAnimation&&(console.error('The option "fadeAnimation" : '+a.fadeAnimation+" is not a valid"),b=!1)),a.hasOwnProperty("controller")&&("string"!==Object.toType(a.controller)?(console.error('The option "controller" must be a string'),b=!1):"mouse"!==a.controller&&"keyboard"!==a.controller&&"gamepad"!==a.controller&&(console.error('The option "controller" : '+a.controller+" is not a valid"),b=!1)),a.hasOwnProperty("moveStep")&&"number"!==Object.toType(a.moveStep)&&(console.error('The option "moveStep" must be a number'),b=!1),a.hasOwnProperty("scaleOn")&&"boolean"!==Object.toType(a.scaleOn)&&(console.error('The option "scaleOn" must be a boolean'),b=!1),a.hasOwnProperty("scale")&&"number"!==Object.toType(a.scale)&&(console.error('The option "scale" must be a number'),b=!1),a.hasOwnProperty("minScale")&&"number"!==Object.toType(a.minScale)&&(console.error('The option "minScale" must be a number'),b=!1),a.hasOwnProperty("maxScale")&&"number"!==Object.toType(a.maxScale)&&(console.error('The option "maxScale" must be a number'),b=!1),a.hasOwnProperty("spreadMode")&&("string"!==Object.toType(a.spreadMode)?(console.error('The option "spreadMode" must be a string'),b=!1):"random"!==a.spreadMode&&"shuffle"!==a.spreadMode&&(console.error('The option "spreadMode" : '+a.spreadMode+" is not a valid"),b=!1)),a.hasOwnProperty("numberTile")&&"number"!==Object.toType(a.numberTile)&&(console.error('The option "numberTile" must be a number'),b=!1),a.hasOwnProperty("onClickCallback")&&"function"!==Object.toType(a.onClickCallback)&&(console.error('The option "onClickCallback" must be a function'),b=!1),a.hasOwnProperty("mouseoverCallback")&&"function"!==Object.toType(a.mouseoverCallback)&&(console.error('The option ""mouseoverCallback" must be a function'),b=!1),b)}function OpenInNewTab(a){var b=window.open(a,"_blank");b.focus()}function applyWheel(a){var b=window.event||a,c=b.detail?-120*b.detail:b.wheelDelta;startWheel=new Date,diffWheel=(startWheel-lastWheel)/1e3,wall.goScale(c)}function isEmpty(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function easeOutCubic(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b}function easeOutQuart(a,b,c,d){return a/=d,a--,-c*(a*a*a*a-1)+b}function easeInOutSine(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}function easeCustom(a,b,c,d){return c+Math.floor((b-c)/20)}function easeOutCubic(a,b,c,d){return a/=d,a--,c*(a*a*a+1)+b}var canvas,ctx,lastTileHovered={},lastOffsetX=1,lastPositionX=1,shuffleCounter=0,fps={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var a=(new Date).getTime(),b=(a-this.startTime)/1e3,c=Math.floor(this.frameNumber/b);return b>1&&(this.startTime=(new Date).getTime(),this.frameNumber=0),c}},iFrequency=50,myInterval=0;!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var request;Object.toType=function(a){return function(b){return b===a?"global":{}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}}(this);var el=document.getElementById("viewport"),eventHandler=new Hammer(el);eventHandler.get("pan").set({direction:Hammer.DIRECTION_ALL}),eventHandler.get("pinch").set({enable:!0}),eventHandler.get("rotate").set({enable:!0});var lastX,lastY,deltaX=0,deltaY=0,intervalCounter=0,startWheel,lastWheel,diffWheel;startWheel=lastWheel=new Date;var pinchSensitivity=6e-5,tileCentered,lastTileCentered,gamepad=new Gamepad;gamepad.on("connect",function(a){console.log("controller "+a.index+" connected!")}),gamepad.on("disconnect",function(a){console.log("controller "+a.index+" disconnected!")}),Wall.prototype.setTrigger=function(){var a=this;if("mouse"==this.settings.controller){eventHandler.on("panstart",function(a){lastX=a.center.x,lastY=a.center.y}),eventHandler.on("panmove",function(b){deltaX=lastX-b.center.x,deltaY=lastY-b.center.y,a.goTranslate(deltaX,deltaY),lastX=b.center.x,lastY=b.center.y}),eventHandler.on("panend",function(a){});var b=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";el.attachEvent?el.attachEvent("on"+b,applyWheel):el.addEventListener&&el.addEventListener(b,applyWheel,!1),eventHandler.on("tap",function(b){var c=a.getTile(b.center.x,b.center.y);a.onClick(c)}),el.addEventListener("mousemove",function(b){var c=a.getTile(b.pageX,b.pageY);a.onMouseover(c)}),eventHandler.on("pinchin",function(b){a.goScale(b.scale)}),eventHandler.on("pinchout",function(b){a.goScale(-b.scale)})}"keyboard"==this.settings.controller&&$(document).keydown(function(b){switch(b.which){case 37:a.goTranslate(-a.settings.moveStep,0);break;case 38:a.goTranslate(0,a.settings.moveStep);break;case 39:a.goTranslate(a.settings.moveStep,0);break;case 40:a.goTranslate(0,-a.settings.moveStep);break;case 79:a.goScale(100);break;case 80:a.goScale(-100);break;default:return}b.preventDefault()}),"gamepad"==this.settings.controller&&(gamepad.on("press","button_1",function(){console.log("Button cross was pressed!"),a.settings.onPressButton1Callback(tileCentered)}),gamepad.on("press","button_2",function(){console.log("Button circle was pressed!"),a.settings.onPressButton2Callback()}),gamepad.on("press","button_3",function(){console.log("Button square was pressed!"),a.settings.onPressButton3Callback()}),gamepad.on("press","button_4",function(){console.log("Button triangle was pressed!"),a.settings.onPressButton4Callback()}),gamepad.on("hold","stick_axis_left",function(b){a.goTranslate(5*b.value[0],5*b.value[1]),tileCentered=a.getTile(a.width/2,a.height/2),tileCentered.focus=!0,isEmpty(lastTileCentered)?lastTileCentered=tileCentered:tileCentered!==lastTileCentered&&(lastTileCentered.focus=!1,lastTileCentered=tileCentered)}),gamepad.on("hold","stick_axis_right",function(b){a.goScale(10*-b.value[1])}),gamepad.on("hold","d_pad_up",function(b){console.log(b.button+" was pressed!"),a.settings.onPressDPadUpCallback()}),gamepad.on("hold","d_pad_down",function(b){console.log(b.button+" was pressed!"),a.settings.onPressDPadDownCallback()}),gamepad.on("hold","d_pad_left",function(b){console.log(b.button+" was pressed!"),a.settings.onPressDPadLeftCallback()}),gamepad.on("hold","d_pad_right",function(b){console.log(b.button+" was pressed!"),a.settings.onPressDPadRightCallback()}),gamepad.on("press","start",function(b){console.log(b.button+" was pressed!"),a.settings.onPressStartCallback()}),gamepad.on("press","select",function(b){console.log(b.button+" was pressed!"),a.settings.onPressSelectCallback()}))},window.onresize=function(a){wall.updateSizeViewport()};var hasOwnProperty=Object.prototype.hasOwnProperty;